{% extends 'base.html' %}
{% load render_table from django_tables2 %}

{% block title %}Exam info {% endblock %}

{% block scripts %}
let groupForm, container, addButton, totalForms, formNum
{% endblock %}

{% block content %}

{% if user_allowed %}


{% endif %}
<h4>MANAGE PAGES GROUP</h4>

<form method="POST">
  {% csrf_token %}
  {{exam_pages_groups_formset.management_form}}
  <button type="submit" style="margin-top:20px;margin-bottom:20px;" class="btn btn-primary btn-sm">Save Groups</button>
  <table class="table table-sm table-borderless" style="width:850px;">
    <tbody id="form-container">
    <tr style="border-bottom:.5px solid lightgrey;">
      <th>Name</th>
      <th>Page from</th>
      <th>Page to</th>
      <th>Delete ? (On 'SAVE GROUPS' click)</th>

    </tr>
    <tr class="exam-pages-group-form" style="display:none;">
      <td hidden style="width:20%;">{{ exam_pages_groups_formset.empty_form.id }}</td>
      <td style="width:20%;">{{ exam_pages_groups_formset.empty_form.group_name }}</td>
      <td style="width:20%;">{{ exam_pages_groups_formset.empty_form.page_from }}</td>
      <td style="width:20%;">{{ exam_pages_groups_formset.empty_form.page_to }}</td>
      <td style="width:40%;text-align:center">{{ form.DELETE }} </td>
    <tr/>
    {% for form in exam_pages_groups_formset %}
    <tr class="exam-pages-group-form">
      <td hidden style="width:20%;">{{ form.id }}</td>
      <td style="width:20%;">{{ form.group_name }}</td>
      <td style="width:20%;">{{ form.page_from }}</td>
      <td style="width:20%;">{{ form.page_to }}</td>
      <td style="width:40%;text-align:center">{{ form.DELETE }} </td>
    <tr/>
    {% endfor %}
    </tbody>

  </table>
  <button id="add-form" type="button" style="margin-top:20px;" class="btn btn-outline-info btn-sm">Add Another Group</button>




</form>

<script type="text/javascript">
  groupForm = document.querySelectorAll(".exam-pages-group-form")
  container = document.querySelector("#form-container")
  addButton = document.querySelector("#add-form")
  totalForms = document.querySelector("#id_form-TOTAL_FORMS")

  formNum = groupForm.length-1
  addButton.addEventListener('click', addForm)

  function addForm(e){
    e.preventDefault()

    newGroupForm = groupForm[0].cloneNode(true)
    formRegex = RegExp(`form-__prefix__-`,'g')

    formNum++
    newGroupForm.innerHTML = newGroupForm.innerHTML.replace(formRegex, `form-${formNum}-`)
    newGroupForm.removeAttribute('style')
    container.appendChild(newGroupForm)
    totalForms.setAttribute('value', `${formNum+1}`)
  }

</script>












{% endblock %}
