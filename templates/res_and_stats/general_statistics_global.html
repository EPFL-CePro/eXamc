{% load custom_tags %}
<button class="btn" onclick="downloadElementAsPDF({title:'Global statistics',
                                              subtitle:'{{ exam_selected.code }} - {{ exam_selected.date|date:'Y-m-d' }}',
                                              elementId:'distributions_table_div',
                                              fileName:'{{ exam_selected.code }}_{{ exam_selected.date|date:'Y-m-d' }}_global_statistics.pdf'});"
   style="margin-left:10px">
    <i class="fa-regular fa-file-pdf fa-2xl" style="color: #db0a0a;"><i class="fa-solid fa-circle-arrow-down fa-2xs" style="margin-left:-35px;"></i></i>
</button>
<div id="distributions_table_div">
  <div class="table-responsive">
    <table id="distribution_dt" class="table table-striped table-sm">
      <thead>
        <tr>
          <th colspan="2">Students : {% if exam_selected.is_overall %}{{ exam_selected.get_sum_common_students }}{% else %}{{ exam_selected.students.all|length }}{% endif %} </th>
          <th colspan="2">Present :  {{ exam_selected.present_students }} </th>
          <th colspan="4">Absent : {{ absent }} </th>
          <th colspan="17"/>
        </tr>
        <tr>
          <th>Scale</th>
          <th>Average</th>
          <th>Median</th>
          <th>Std. dev.</th>
          {% for grade in grade_list %}
          <th>{{ grade }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for scale_stat in exam_selected.scaleStatistics.all %}
        {% if scale_stat.section == 'global' %}
        <tr>
          <th>{{ scale_stat.scale.name }}{% if scale_stat.scale.final %} <i class="fa-solid fa-circle-check fa-xs"></i>{% endif %}</th>
          <th>{{ scale_stat.average }}</th>
          <th>{{ scale_stat.median }}</th>
          <th>{{ scale_stat.stddev }}</th>
          {% for distribution in scale_stat.scaleDistributions.all %}
          <th>{{ distribution.quantity }}</th>
          {% endfor %}
        </tr>
        <tr>
          <th colspan="4"/>
          <th colspan="8">Achievement : {{ scale_stat|get_achievement_by_scalestat }} </th>
          <th colspan="8">Non Achievement : {{ scale_stat|get_nonachievement_by_scalestat }}</th>
          <th/>
        </tr>
        {% endif %}
        {% endfor %}
      </tbody>
    </table>
    <canvas id="canvas" class="chartjs-render-monitor" style="object-fit: contain" ></canvas>
  </div>

</div>

