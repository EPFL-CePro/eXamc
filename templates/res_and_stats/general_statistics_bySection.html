{% load custom_tags %}
</br>
<h6>Scales :</h6>
<ul class="nav nav-pills flex-column flex-sm-row border" id="stats-byTeacher-pills-tab" role="tablist">
  {% with exam.scales.all|first as first_scale %}
  {% for scale in exam.scales.all %}
  {% if scale.pk == first_scale.pk %}
  <li class="nav-item" role="presentation">
    <a class="flex-sm-fill text-sm-center nav-link active" id="bySection-{{ scale.pk }}-tab" data-toggle="pill" href="#pills-bySection-{{ scale.pk }}" role="tab" aria-controls="pills-bySection-{{ stat.scale.pk }}" aria-selected="true">{{ scale.name }}{% if scale.final %} <i class="fa-solid fa-circle-check fa-xs"></i>{% endif %}</a>
  </li>
  {% else %}
  <li class="nav-item" role="presentation">
    <a class="flex-sm-fill text-sm-center nav-link" id="bySection-{{ scale.pk }}-tab" data-toggle="pill" href="#pills-bySection-{{ scale.pk }}" role="tab" aria-controls="pills-bySection-{{ stat.scale.pk }}" aria-selected="false">{{ scale.name }}{% if scale.final %} <i class="fa-solid fa-circle-check fa-xs"></i>{% endif %}</a>
  </li>
  {% endif %}
  {% endfor %}
  {% endwith %}
</ul>
<div class="tab-content" id="stats-byTeacher-pills-tabContent" style="max-height:80vh;overflow-y:scroll;">
  {% with exam.scales.all|first as first_scale %}
  {% for scale in exam.scales.all %}
  {% if scale.pk == first_scale.pk %}
    <div class="tab-pane fade show active" id="pills-bySection-{{ scale.pk }}" role="tabpanel" aria-labelledby="pills-bySection-{{ scale.pk }}-tab" style="max-width:80%;">
  {% else %}
    <div class="tab-pane fade" id="pills-bySection-{{ scale.pk }}" role="tabpanel" aria-labelledby="pills-bySection-{{ scale.pk }}-tab" style="max-width:80%;">
  {% endif %}
      <button class="btn" onclick="downloadElementAsPDF({title:'Statistics by section',
                                                      subtitle:'{{ exam_selected.code }} - {{ exam_selected.date|date:'Y-m-d' }} : {{ scale.name }}',
                                                      elementId:'stats-bySection-{{ scale.pk }}-table-div',
                                                      fileName:'{{ exam_selected.code }}_{{ exam_selected.date|date:'Y-m-d' }}_{{ scale.name }}_statistics_sections.pdf'});"
           style="margin-left:10px">
            <i class="fa-regular fa-file-pdf fa-2xl" style="color: #db0a0a;"><i class="fa-solid fa-circle-arrow-down fa-2xs" style="margin-left:-35px;"></i></i>
        </button>
    <div class="table-responsive" id="stats-bySection-{{ scale.pk }}-table-div">
        <table id="bySection_distribution_dt{{ scale.pk }}" class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Exam</th>
              <th>Average</th>
              <th>Median</th>
              <th>Stddev</th>
              <th>Students</th>
              <th>Present</th>
              <th>Absent</th>
              {% for grade in grade_list %}
              <th>{{ grade }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for stat in exam|get_sections_scaleStats_by_examScale:scale %}
            <tr>
              <th>{{ stat.section }}</th>
              <th>{{ stat.average }}</th>
              <th>{{ stat.stddev }}</th>
              <th>{{ stat.median }}</th>
              <th>{{ stat.section_nb_students }}</th>
              <th>{{ stat.section_presents }}</th>
              <th>{{ stat.section_nb_students|substract:stat.section_presents }}</th>
              {% for dist in stat.scaleDistributions.all %}
              <th>{{ dist.quantity }}</th>
              {% endfor %}
            </tr>
            <tr>
                <th colspan="7"/>
                <th colspan="8">Achievement : {{ stat|get_achievement_by_scalestat }} </th>
                <th colspan="8">Non Achievement : {{ stat|get_nonachievement_by_scalestat }}</th>
                <th/>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <canvas id="canvas-bySection-{{scale.pk}}" class="chartjs-render-monitor" style="object-fit: contain;"></canvas>
    </div>
    {% endfor %}
    {% endwith %}
  </div>
